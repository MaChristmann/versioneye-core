class SecurityVulnerability < Versioneye::Model

  include Mongoid::Document
  include Mongoid::Timestamps

  # Belongs to the product with this attributes
  field :language  , type: String
  field :prod_key  , type: String

  field :summary, type: String # the summary of the security vulnerability
  field :cve    , type: String # CVE = Common Vulnerabilities and Exposures - https://cve.mitre.org/

  field :affected_versions_string, type: String 
  field :affected_versions, type: Array, default: []

  field :links, type: Hash, default: {}

  field :approved, type: Boolean, default: true 
  
  index({ language: 1, prod_key: 1, summary: 1}, { name: "lang_prod_key_summary_index", background: true, unique: true, drop_dups: true })

  scope :by_language   , ->(lang){where(language: lang)}
  scope :by_prod_key   , ->(prod_key){where(prod_key: prod_key)}

  def product 
    Product.fetch_product language, prod_key
  end

end
